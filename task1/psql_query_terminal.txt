psql -U username -d db_name -h localhost -p 5432 -c "\copy (SELECT json_agg(json_build_object('room_name', sub.room_name, 'students_count', sub.count)) FROM (SELECT r.name AS room_name, COUNT(s.id) AS count FROM rooms r LEFT JOIN students s ON r.id = s.room_id GROUP BY r.name ORDER BY CAST(SUBSTRING(r.name FROM '#(\\d+)$') AS INTEGER)) sub) TO '/path/name.json';"

psql -U username -d db_name -h localhost -p 5432 -c "\copy (SELECT json_agg(json_build_object('room_name', room_name, 'average_age', average_age)) FROM (WITH RoomAverage AS (SELECT r.name AS room_name, ROUND(AVG(EXTRACT(YEAR FROM AGE(CURRENT_DATE, s.birthday)) + EXTRACT(MONTH FROM AGE(CURRENT_DATE, s.birthday)) / 12 + EXTRACT(DAY FROM AGE(CURRENT_DATE, s.birthday)) / 365), 0) AS average_age FROM rooms AS r JOIN students AS s ON r.id = s.room_id GROUP BY r.name) SELECT room_name, average_age FROM RoomAverage ORDER BY average_age ASC LIMIT 5) sub) TO '/path/name.json';"

psql -U username -d db_name -h localhost -p 5432 -c "\copy (SELECT json_agg(json_build_object('room_id', room_id, 'room_name', room_name, 'age_range', age_range)) FROM (WITH AgeRange AS (SELECT r.id AS room_id, r.name AS room_name, MAX(EXTRACT(YEAR FROM AGE(s.birthday))) - MIN(EXTRACT(YEAR FROM AGE(s.birthday))) AS age_range FROM rooms r JOIN students s ON r.id = s.room_id GROUP BY r.id, r.name) SELECT room_id, room_name, age_range FROM AgeRange ORDER BY age_range DESC LIMIT 5) sub) TO '/path/name.json';"

psql -U username -d db_name -h localhost -p 5432 -c "\copy (SELECT json_agg(json_build_object('room_name', room_name)) FROM (WITH RoomGenders AS (SELECT r.name AS room_name, COUNT(DISTINCT s.gender) AS gender_count FROM rooms r JOIN students s ON r.id = s.room_id GROUP BY r.name HAVING COUNT(DISTINCT s.gender) > 1) SELECT room_name FROM RoomGenders ORDER BY CAST(SUBSTRING(room_name FROM '#([0-9]+)') AS INTEGER)) sub) TO '/path/name.json';"
